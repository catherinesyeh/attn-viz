(function(e){function t(t){for(var o,s,c=t[0],r=t[1],l=t[2],h=0,u=[];h<c.length;h++)s=c[h],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&u.push(a[s][0]),a[s]=0;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);d&&d(t);while(u.length)u.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,c=1;c<n.length;c++){var r=n[c];0!==a[r]&&(o=!1)}o&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},a={app:0},i=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],r=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var d=r;i.push([4,"chunk-vendors"]),n()})({0:function(e,t){},"057b":function(e,t,n){},1:function(e,t){},2:function(e,t){},"228a":function(e,t,n){"use strict";n("51bc")},3:function(e,t){},4:function(e,t,n){e.exports=n("cd49")},4678:function(e,t,n){var o={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b8","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b8","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=i,e.exports=a,a.id="4678"},"51bc":function(e,t,n){},"5afb":function(e,t,n){"use strict";n("057b")},"701c":function(e,t,n){},"749d":function(e,t,n){"use strict";n("9be0")},9143:function(e,t,n){},9457:function(e,t,n){"use strict";n("701c")},"9be0":function(e,t,n){},a39d:function(e,t,n){"use strict";n("9143")},cd49:function(e,t,n){"use strict";n.r(t);n("5783");var o=n("59a5"),a=(n("5704"),n("b558")),i=(n("6ba6"),n("5efb")),s=(n("2ef0"),n("9839")),c=(n("ee00"),n("bb76")),r=n("7a23");const l={class:"navbar navbar-light bg-light"},d={class:"container-fluid"},h=Object(r["k"])("span",{class:"navbar-brand mb-0 h1"},"Attention Viz",-1),u={class:"dropdown"},b=Object(r["k"])("label",{for:"layernum"},"Zoom to Layer:",-1),m=Object(r["k"])("label",{for:"headnum"},"Head:",-1),p=Object(r["l"])(" go "),g=Object(r["l"])(" reset zoom "),j=Object(r["l"])(" view all "),f={class:"dropdown"},y=Object(r["k"])("label",{for:"model"},"Model:",-1),O=Object(r["k"])("label",{for:"graph-type"},"Graph Type:",-1),k=Object(r["k"])("label",{for:"color-by"},"Color By:",-1),v={class:"main"},w={class:"row"},x={class:"col-2"},T={class:"col-10"};function _(e,t,n,o,a,i){const s=Object(r["H"])("a-select-option"),c=Object(r["H"])("a-select"),_=Object(r["H"])("a-button"),A=Object(r["H"])("font-awesome-icon"),z=Object(r["H"])("AttnMap"),P=Object(r["H"])("Projection");return Object(r["A"])(),Object(r["j"])(r["b"],null,[Object(r["k"])("nav",l,[Object(r["k"])("div",d,[h,Object(r["k"])("div",u,[b,Object(r["m"])(c,{ref:"layer-select",value:e.layernum,"onUpdate:value":t[0]||(t[0]=t=>e.layernum=t),style:{width:"60px"},layerNum:e.layernum,onChange:t[1]||(t[1]=t=>e.handleChange("layer",e.layernum))},{default:Object(r["O"])(()=>[(Object(r["A"])(),Object(r["j"])(r["b"],null,Object(r["G"])(12,e=>Object(r["m"])(s,{value:e-1},{default:Object(r["O"])(()=>[Object(r["l"])(Object(r["J"])(e-1),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","layerNum"]),m,Object(r["m"])(c,{ref:"head-select",value:e.headnum,"onUpdate:value":t[2]||(t[2]=t=>e.headnum=t),style:{width:"60px"},headNum:e.headnum,onChange:t[3]||(t[3]=t=>e.handleChange("head",e.headnum))},{default:Object(r["O"])(()=>[(Object(r["A"])(),Object(r["j"])(r["b"],null,Object(r["G"])(12,e=>Object(r["m"])(s,{value:e-1},{default:Object(r["O"])(()=>[Object(r["l"])(Object(r["J"])(e-1),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","headNum"]),Object(r["m"])(_,{type:"primary",id:"zoom-go",onClick:e.zoomToPlot},{default:Object(r["O"])(()=>[p]),_:1},8,["onClick"]),Object(r["m"])(_,{type:"text",class:"matrix-reset",onClick:e.onClickReset},{default:Object(r["O"])(()=>[g]),_:1},8,["onClick"]),Object(r["m"])(_,{type:"text",class:Object(r["u"])(["matrix-reset",{disabled:"matrix"==e.mode}]),onClick:e.resetToMatrix},{default:Object(r["O"])(()=>[j]),_:1},8,["onClick","class"])]),Object(r["k"])("div",f,[y,Object(r["m"])(c,{value:e.modelType,"onUpdate:value":t[4]||(t[4]=t=>e.modelType=t),style:{width:"80px"},options:e.modelOptions},null,8,["value","options"]),O,Object(r["m"])(c,{value:e.projectionMethod,"onUpdate:value":t[5]||(t[5]=t=>e.projectionMethod=t),style:{width:"80px"},options:e.projectionMethods},null,8,["value","options"]),k,Object(r["m"])(c,{value:e.colorBy,"onUpdate:value":t[6]||(t[6]=t=>e.colorBy=t),style:{width:"120px"},options:e.colorByOptions},null,8,["value","options"]),Object(r["m"])(r["e"],null,{default:Object(r["O"])(()=>[Object(r["m"])(A,{icon:e.icon,onClick:e.toggleTheme},null,8,["icon","onClick"])]),_:1})])])]),Object(r["k"])("div",v,[Object(r["k"])("div",w,[Object(r["k"])("div",x,[Object(r["m"])(z)]),Object(r["k"])("div",T,[Object(r["m"])(P,{ref:"projection"},null,512)])])])],64)}n("f9e3");var A=n("5502"),z=n("bc3a"),P=n.n(z);console.log("production");const B="http://localhost:8500";function L(e){return new Promise((t,n)=>{const o=B+"/"+e;P.a.get(o).then(n=>{console.log("promose resolve: "+e,n),t(n.data)}).catch(t=>{console.log("promose reject: "+e),n(t)})})}function C(e,t){return new Promise((n,o)=>{const a=B+"/"+e;P.a.post(a,t).then(t=>{console.log("promose resolve: "+e,t),n(t.data)}).catch(t=>{console.log("promose reject: "+e),o(t)})})}async function M(e){return L("getMatrixData/"+e)}async function D(e){return L("getTokenData/"+e)}async function S(e,t){return C("getAttentionByToken/"+t,e)}console.log(B);const H=Symbol(),I=Object(A["a"])({state:{matrixData:[],tokenData:[],layer:"",head:"",doneLoading:!1,renderState:!0,attentionLoading:!1,attentionByToken:{layer:0,head:0,attns:[],token:{}},modelType:"gpt",projectionMethod:"tsne",colorBy:"type",highlightedTokenIndices:[],mode:"matrix",view:"none",dimension:"2D",userTheme:"light-theme",showAll:!1,showAttention:!1,sizeByNorm:!1},modules:{},getters:{},mutations:{setMatrixData(e,t){e.matrixData=t},setTokenData(e,t){e.tokenData=t},setLayer(e,t){e.layer=t},setHead(e,t){e.head=t},updateDoneLoading(e,t){e.doneLoading=t,console.log("state: doneLoading",t)},updateAttentionLoading(e,t){e.attentionLoading=t,console.log("state: attentionLoading",t)},updateRenderState(e,t){e.renderState=t,console.log("state: renderState",t)},setAttentionByToken(e,t){e.attentionByToken=t},setModelType(e,t){e.modelType=t,console.log("setModelType",t)},setProjectionMethod(e,t){e.projectionMethod=t,console.log("setProjectionMethod",t)},setColorBy(e,t){e.colorBy=t,console.log("setColorBy",t)},setHighlightedTokenIndices(e,t){e.highlightedTokenIndices=t},setView(e,t){e.view=t,console.log("setView",t)},setMode(e,t){e.mode=t,console.log("setMode",t)},setDimension(e,t){e.dimension=t,console.log("setDimension",t)},setUserTheme(e,t){e.userTheme=t,console.log("setUserTheme",t)},setShowAll(e,t){e.showAll=t,console.log("setShowAll",t)},setShowAttention(e,t){e.showAttention=t,console.log("setShowAttention",t)},setSizeByNorm(e,t){e.sizeByNorm=t,console.log("setSizeByNorm",t)}},actions:{async init({state:e,dispatch:t}){t("computeData")},async computeData({state:e,commit:t}){t("updateRenderState",!0);const n=(await M(e.modelType)).data;t("setMatrixData",Object.freeze(n));const o=(await D(e.modelType)).tokens;t("setTokenData",Object.freeze(o)),t("updateDoneLoading",!0)},async switchModel({state:e,commit:t,dispatch:n},o){t("setModelType",o),t("updateDoneLoading",!1),n("computeData")},async setClickedPoint({state:e,commit:t},n){console.log("setClickedPoint",n);const o=await S(n,e.modelType);console.log("attentionDataByToken",o),t("setAttentionByToken",o),t("updateAttentionLoading",!1)}},strict:!1});function V(){return Object(A["b"])(H)}const N={class:"viewHead"};function F(e,t,n,o,a,i){return Object(r["A"])(),Object(r["j"])("div",N," User Config Panel ")}var E={components:{},setup(){V();const e=Object(r["E"])({});return{...Object(r["K"])(e)}}},$=(n("749d"),n("6b0d")),U=n.n($);const q=U()(E,[["render",F]]);var R=q;const Z={id:"matrix-wrapper"},J={id:"label-wrapper"},Y={id:"loading"},G={id:"matrix-labels"},K=Object(r["k"])("p",{class:"axis-label"},[Object(r["k"])("span",{class:"head-axis"},"head →"),Object(r["k"])("span",{class:"layer-axis"},"layer ↓")],-1),X=Object(r["k"])("p",{class:"label"},"Search",-1),W=Object(r["l"])("clear"),Q=Object(r["k"])("p",{class:"label"},"Labels",-1),ee=Object(r["l"])("show"),te=Object(r["k"])("p",{class:"label"},"Attention Lines",-1),ne=Object(r["l"])("show"),oe=Object(r["k"])("p",{class:"label"},"Dot Size",-1),ae=Object(r["l"])("scale by norm"),ie=Object(r["k"])("p",{class:"label"},"Developer Tool",-1),se=Object(r["l"])(" log viewport "),ce=Object(r["k"])("p",{class:"label"},"Mode",-1),re=Object(r["l"])("2D"),le=Object(r["l"])("3D"),de=Object(r["k"])("p",{class:"label"},"Controls",-1),he={id:"control-buttons"},ue={class:"arrow-group center"},be=Object(r["k"])("div",{class:"gradient-edge"},null,-1),me={class:"gradient-edge right"};function pe(e,t,n,o,a,i){const s=Object(r["H"])("a-input-search"),c=Object(r["H"])("a-button"),l=Object(r["H"])("a-checkbox"),d=Object(r["H"])("a-radio-button"),h=Object(r["H"])("a-radio-group"),u=Object(r["H"])("ArrowUpOutlined"),b=Object(r["H"])("ArrowLeftOutlined"),m=Object(r["H"])("ArrowRightOutlined"),p=Object(r["H"])("ArrowDownOutlined"),g=Object(r["H"])("Legend"),j=Object(r["H"])("MatrixView");return Object(r["A"])(),Object(r["j"])("div",null,[Object(r["k"])("div",Z,[Object(r["k"])("div",J,[Object(r["P"])(Object(r["k"])("span",Y,"Loading...",512),[[r["L"],e.renderState]]),Object(r["P"])(Object(r["k"])("div",G,[K,X,Object(r["m"])(s,{value:e.searchToken,"onUpdate:value":t[0]||(t[0]=t=>e.searchToken=t),placeholder:"Search tokens","enter-button":"",onSearch:t[1]||(t[1]=t=>e.onSearch(e.searchToken)),spellcheck:"false"},null,8,["value"]),Object(r["m"])(r["e"],null,{default:Object(r["O"])(()=>[Object(r["P"])(Object(r["m"])(c,{class:"clear",type:"link",onClick:e.clearSearch},{default:Object(r["O"])(()=>[W]),_:1},8,["onClick"]),[[r["L"],""!=e.searchToken]])]),_:1}),Q,Object(r["m"])(l,{checked:e.showAll,"onUpdate:checked":t[2]||(t[2]=t=>e.showAll=t),onClick:e.toggleCheckbox,class:Object(r["u"])({disabled:"matrix"==e.mode})},{default:Object(r["O"])(()=>[ee]),_:1},8,["checked","onClick","class"]),te,Object(r["m"])(l,{checked:e.showAttention,"onUpdate:checked":t[3]||(t[3]=t=>e.showAttention=t),onClick:e.toggleCheckboxAttention,class:Object(r["u"])({disabled:"matrix"==e.mode||"attn"!=e.view})},{default:Object(r["O"])(()=>[ne]),_:1},8,["checked","onClick","class"]),oe,Object(r["m"])(l,{checked:e.sizeByNorm,"onUpdate:checked":t[4]||(t[4]=t=>e.sizeByNorm=t),onClick:e.toggleCheckboxNorm,class:Object(r["u"])({disabled:"matrix"==e.mode})},{default:Object(r["O"])(()=>[ae]),_:1},8,["checked","onClick","class"]),ie,Object(r["m"])(c,{type:"primary",onClick:e.logViewport},{default:Object(r["O"])(()=>[se]),_:1},8,["onClick"]),Object(r["k"])("div",null,[ce,Object(r["m"])(h,{value:e.dimension,"onUpdate:value":t[5]||(t[5]=t=>e.dimension=t)},{default:Object(r["O"])(()=>[Object(r["m"])(d,{value:"2D"},{default:Object(r["O"])(()=>[re]),_:1}),Object(r["m"])(d,{value:"3D"},{default:Object(r["O"])(()=>[le]),_:1})]),_:1},8,["value"])]),Object(r["m"])(r["e"],null,{default:Object(r["O"])(()=>[Object(r["P"])(Object(r["k"])("div",null,[de,Object(r["k"])("div",he,[Object(r["m"])(c,{class:Object(r["u"])(["center",{disabled:e.layer<1}]),type:"default",size:"small",onClick:t[6]||(t[6]=t=>e.moveToPlot("up")),disabled:e.layer<1},{icon:Object(r["O"])(()=>[Object(r["m"])(u)]),_:1},8,["class","disabled"]),Object(r["k"])("div",ue,[Object(r["m"])(c,{type:"default",size:"small",class:Object(r["u"])({disabled:e.head<1}),onClick:t[7]||(t[7]=t=>e.moveToPlot("left")),disabled:e.head<1},{icon:Object(r["O"])(()=>[Object(r["m"])(b)]),_:1},8,["class","disabled"]),Object(r["m"])(c,{type:"default",size:"small",class:Object(r["u"])({disabled:e.head>10}),onClick:t[8]||(t[8]=t=>e.moveToPlot("right")),disabled:e.head>10},{icon:Object(r["O"])(()=>[Object(r["m"])(m)]),_:1},8,["class","disabled"])]),Object(r["m"])(c,{class:Object(r["u"])(["center",{disabled:e.layer>10}]),type:"default",size:"small",onClick:t[9]||(t[9]=t=>e.moveToPlot("down")),disabled:e.layer>10},{icon:Object(r["O"])(()=>[Object(r["m"])(p)]),_:1},8,["class","disabled"])])],512),[[r["L"],"single"===e.mode]])]),_:1})],512),[[r["L"],!e.renderState]])]),be,Object(r["k"])("div",me,[Object(r["m"])(g)]),Object(r["P"])(Object(r["m"])(j,{ref:"matrixView"},null,512),[[r["L"],!e.renderState]])])])}const ge={id:"matrix-canvas"};function je(e,t,n,o,a,i){return Object(r["A"])(),Object(r["j"])("canvas",ge)}var fe=n("9b26"),ye=n("8c2f"),Oe=n("6083"),ke=n("125d"),ve=n("fbbb"),we=n("3cd3"),xe=n("475f"),Te=(n("13d5"),n("898b"));const _e=(e,t,n=100,o=100,a=20)=>{var i=[];const s=t.map(e=>e.value),c=t.map(e=>e.type),r=e=>e.reduce((e,t)=>t.length>e.length?t:e,e[0]),l=r(s).length,d=Te["f"]((function(e){return Te["d"](.75*e+.25)})).domain([0,1]),h=Te["f"]((function(e){return Te["c"](.75*e+.25)})).domain([0,1]),u=e=>{var t,n="rgb()";"query"===e.type?n=d(e.position):"key"===e.type&&(n=h(e.position));const o=null===(t=Te["a"](n))||void 0===t?void 0:t.rgb();return o?[o.r,o.g,o.b]:[0,0,0]},b=t.map(e=>u(e)),m=e=>{var t,n="rgb()";"query"===e.type?n=d(e.value.length/l):"key"===e.type&&(n=h(e.value.length/l));const o=null===(t=Te["a"](n))||void 0===t?void 0:t.rgb();return o?[o.r,o.g,o.b]:[0,0,0]},p=t.map(e=>m(e)),g=["#F5C0CA","#E3378F","#F0D6A5","#EDB50E","#C4D6B8","#5FB96C","#C8DDED","#528DDB","#D6BAE3","#A144DB"],j=g.length/2,f=e=>{var t,n="rgb()";"query"===e.type?n=g[e.pos_int%j*2+1]:"key"===e.type&&(n=g[e.pos_int%j*2]);const o=null===(t=Te["a"](n))||void 0===t?void 0:t.rgb();return o?[o.r,o.g,o.b]:[0,0,0]},y=t.map(e=>f(e)),O=["#F39226","#E3378F","#2E93D9","#5FB96C"],k=e=>{var t,n="rgb()",o=e.value.replace(/[.,\/#!$?%\^&\*;:{}+=\-_`'"~()]/g,"");n=0==o.length?"query"===e.type?O[2]:O[0]:"query"===e.type?O[3]:O[1];const a=null===(t=Te["a"](n))||void 0===t?void 0:t.rgb();return a?[a.r,a.g,a.b]:[0,0,0]},v=t.map(e=>k(e)),w=t.map(e=>`<b class='${e.type}'>${e.value}</b> (<i>${e.type}</i>, pos: ${e.pos_int} of ${e.length})`),x=t.map(e=>`<b class='${e.type}'>${e.value}</b> (<i>${e.type}</i>, pos: ${e.pos_int} of ${e.length}, pos % 5: ${e.pos_int%5})`),T=t.map(e=>`<b class='${e.type}'>${e.value}</b> (<i>${e.type}</i>, pos: ${e.pos_int} of ${e.length}, length: ${e.value.length})`);let _=[],A=[];for(const z of e){const{layer:e,head:r}=z,l=z.head*(n+a),u=-z.layer*(o+a),m=z.tokens,g=e=>{const t=t=>{if("tsne"===e)return t.tsne_x;if("umap"===e)return t.umap_x;if("pca"===e)return t.pca_x;if("tsne_3d"===e)return t.tsne_x_3d;if("umap_3d"===e)return t.umap_x_3d;if("pca_3d"===e)return t.pca_x_3d;throw Error("Invalid projection method")},a=t=>{if("tsne"===e)return t.tsne_y;if("umap"===e)return t.umap_y;if("pca"===e)return t.pca_y;if("tsne_3d"===e)return t.tsne_y_3d;if("umap_3d"===e)return t.umap_y_3d;if("pca_3d"===e)return t.pca_y_3d;throw Error("Invalid projection method")},i=t=>{if("tsne_3d"===e)return t.tsne_z_3d;if("umap_3d"===e)return t.umap_z_3d;if("pca_3d"===e)return t.pca_z_3d;throw Error("Invalid projection method")},s=Te["e"]().domain(Te["b"](m.map(e=>t(e)))).range([0,n]),c=Te["e"]().domain(Te["b"](m.map(e=>a(e)))).range([0,o]);if("tsne"===e||"umap"===e||"pca"===e)return m.map(e=>[+s(t(e)).toFixed(6)+l,+c(a(e)).toFixed(6)+u]);const r=Te["e"]().domain(Te["b"](m.map(e=>i(e)))).range([0,o]);return m.map(e=>[+s(t(e)).toFixed(6)+l,+c(a(e)).toFixed(6)+u,+r(i(e)).toFixed(6)])},j={tsne:g("tsne"),umap:g("umap"),pca:g("pca"),tsne_3d:g("tsne_3d"),umap_3d:g("umap_3d"),pca_3d:g("pca_3d")};d.domain(Te["b"](m.map(e=>e.norm))),h.domain(Te["b"](m.map(e=>e.norm)));const f=m.map((e,n)=>{var o;const a=t[n].type;let i="rgb()";"query"===a?i=d(e.norm):"key"===a&&(i=h(e.norm));const s=null===(o=Te["a"](i))||void 0===o?void 0:o.rgb();return s?[s.r,s.g,s.b]:[0,0,0]}),O=m.map((e,n)=>`<b class='${t[n].type}'>${t[n].value}</b> (<i>${t[n].type}</i>, pos: ${t[n].pos_int} of ${t[n].length}, norm: ${Math.round(100*e.norm)/100})`),k=m.map(e=>e.norm),P=Te["b"](k),B=P[0],L=P[1],C=L-B,M=k.map(e=>{let t=(e-B)/C;return+t.toFixed(6)}),D=m.map((e,n)=>{var o;const a=t[n].type;let i="rgb()";"query"===a?i="rgb(95, 185, 108)":"key"===a&&(i="rgb(227, 55, 143)");const s=null===(o=Te["a"](i))||void 0===o?void 0:o.rgb();return s?[s.r,s.g,s.b]:[0,0,0]}),S=m.map((t,n)=>({coordinate:{tsne:j.tsne[n],umap:j.umap[n],pca:j.pca[n],tsne_3d:j.tsne_3d[n],umap_3d:j.umap_3d[n],pca_3d:j.pca_3d[n]},color:{type:D[n],position:b[n],categorical:y[n],punctuation:v[n],norm:f[n],length:p[n]},msg:{position:w[n],categorical:x[n],norm:O[n],length:T[n]},layer:e,head:r,index:n,value:s[n],type:c[n],normScaled:M[n]}));_.push(l,n+l),A.push(u,o+u),i.push(...S)}return{points:i,range:{x:Te["b"](_),y:Te["b"](A)}}},Ae=(e,t=100,n=100,o=20)=>{var a=[];for(const i of e)a.push({layer:i.layer,head:i.head,title:`L${i.layer} H${i.head}`,coordinate:[i.head*(t+o),-i.layer*(n+o)]});return a},ze=(e,t,n=100,o=100,a=20)=>{const i=_e(e,t,n,o,a);return{points:i.points,range:i.range,headings:Ae(e,n,o,a)}};var Pe=n("25a5"),Be=n.n(Pe);const Le=100,Ce=100,Me=20;let De,Se,He,Ie=2.5;const Ve={target:[0,0,0],zoom:-1,minZoom:-1.5,maxZoom:9,transitionDuration:1e3},Ne={target:[0,0,0],zoom:Ie,minZoom:-1.5,maxZoom:9,transitionDuration:1e3};let Fe=Ve,Ee=Ne;const $e=225,Ue=50;var qe=Object(r["n"])({components:{},setup(e,t){const n=V(),o=Object(r["E"])({matrixData:Object(r["h"])(()=>n.state.matrixData),tokenData:Object(r["h"])(()=>n.state.tokenData),viewState:Ve,highlightedTokenIndices:Object(r["h"])(()=>n.state.highlightedTokenIndices),attentionByToken:Object(r["h"])(()=>n.state.attentionByToken),projectionMethod:Object(r["h"])(()=>n.state.projectionMethod),colorBy:Object(r["h"])(()=>n.state.colorBy),view:Object(r["h"])(()=>n.state.view),mode:Object(r["h"])(()=>n.state.mode),userTheme:Object(r["h"])(()=>n.state.userTheme),curLayer:Object(r["h"])(()=>n.state.layer),curHead:Object(r["h"])(()=>n.state.head),doneLoading:Object(r["h"])(()=>n.state.doneLoading),showAll:Object(r["h"])(()=>n.state.showAll),showAttention:Object(r["h"])(()=>n.state.showAttention),sizeByNorm:Object(r["h"])(()=>n.state.sizeByNorm),zoom:Ve.zoom,clickedPoint:"",activePoints:[],dimension:Object(r["h"])(()=>n.state.dimension),cursorX:0,cursorY:0,transitionInProgress:!1,attentionLoading:Object(r["h"])(()=>n.state.attentionLoading)});var a=Object(r["I"])({points:[],headings:[],range:{x:[0,0],y:[0,0]}}),i={};const s=e=>{switch(o.projectionMethod){case"tsne":return"2D"===o.dimension?e.coordinate.tsne:e.coordinate.tsne_3d;case"umap":return"2D"===o.dimension?e.coordinate.umap:e.coordinate.umap_3d;case"pca":return"2D"===o.dimension?e.coordinate.pca:e.coordinate.pca_3d;default:throw Error("Invalid projection method!")}},c=new Be.a,l=(e,t)=>{let n=o.zoom<=5?2:o.zoom<=7?2.25:o.zoom<=8.5?2.5:4;o.zoom>3.5&&o.zoom<=8.5&&"3D"===o.dimension&&(n*=1.5);const a={width:t*(1/Math.pow(n,o.zoom))*e.length,height:t};return a},d=e=>{const t=o.clickedPoint.index,n=o.clickedPoint.type,a=s(o.clickedPoint),i=o.tokenData[t].pos_int;let c=t-i;const r=o.tokenData.length/2;return"query"===n?c+=r:c-=r,new ke["a"]({id:"attention-line-layer",pickable:!1,data:e,widthMaxPixels:10,widthScale:5,getSourcePosition:a,getTargetPosition:e=>s(e),getColor:e=>{if(e.index==t||e.type===n)return[255,255,255,0];const a=e.index-c,s=255*o.attentionByToken.attns[i][a];return 0==s?[255,255,255,0]:"query"===n?"light-theme"==o.userTheme?[43,91,25,s]:[194,232,180,s]:"light-theme"==o.userTheme?[117,29,58,s]:[240,179,199,s]},updateTriggers:{getSourcePosition:[o.projectionMethod,o.dimension],getTargetPosition:[o.projectionMethod,o.dimension],getColor:[o.attentionByToken,o.userTheme]}})},h=e=>new ve["a"]({id:"point-outline-layer",pickable:!1,data:e,radiusMaxPixels:8,stroked:!0,getPosition:e=>s(e),getRadius:e=>"single"===o.mode&&o.sizeByNorm?3*(.15+.5*e.normScaled):4,getFillColor:[255,195,0,255],getLineColor:"light-theme"!=o.userTheme?[255,255,255,255]:[0,0,0,255],getLineWidth:1/o.zoom,lineWidthMaxPixels:1,updateTriggers:{getFillColor:[o.userTheme],getRadius:[o.sizeByNorm],getPosition:[o.projectionMethod,o.dimension]}}),u=e=>new ve["a"]({id:"point-layer",pickable:"single"==o.mode,data:e,radiusMaxPixels:5,stroked:"single"==o.mode,getPosition:e=>s(e),getRadius:e=>{let t=.4,n=2;return"single"===o.mode&&o.sizeByNorm&&(t=.15+.5*e.normScaled,n=2*t),0===o.highlightedTokenIndices.length?t:o.highlightedTokenIndices.includes(e.index)?n:t},getLineWidth:e=>o.highlightedTokenIndices.includes(e.index)?1/o.zoom:0,lineWidthMaxPixels:1,getLineColor:e=>{const t="light-theme"!=o.userTheme?[255,255,255,255]:[0,0,0,255],n=[255,255,255,0];return o.highlightedTokenIndices.includes(e.index)?t:n},getFillColor:e=>{const t=e=>{switch(o.colorBy){case"type":return e.color.type;case"position":return e.color.position;case"categorical":return e.color.categorical;case"norm":return e.color.norm;case"punctuation":return e.color.punctuation;case"length":return e.color.length;default:throw Error("invalid color channel")}},n=[...t(e),175],a=[84,148,61,175],i=[157,216,135,175],s=[193,91,125,175],c=[234,138,170,175],r=[...t(e),25];return o.highlightedTokenIndices.length?o.highlightedTokenIndices.includes(e.index)?"query"==e.type?"light-theme"==o.userTheme?a:i:"light-theme"==o.userTheme?s:c:r:n},onClick:(e,t)=>{if("matrix"===o.mode)return;console.log("onClick",e.object),n.commit("setView","attn"),n.commit("updateAttentionLoading",!0);let a=e.object;o.clickedPoint=a,n.dispatch("setClickedPoint",a);let i=o.tokenData[a.index],s=o.tokenData.length/2,c=a.index-i.pos_int,r=Array.from({length:i.length},(e,t)=>t+c);"key"===i.type?c-=s:c+=s;let l=Array.from({length:i.length},(e,t)=>t+c),d=[...r,...l];n.commit("setHighlightedTokenIndices",d)},updateTriggers:{getFillColor:[o.colorBy,o.highlightedTokenIndices,o.userTheme],getRadius:[o.highlightedTokenIndices,o.sizeByNorm],getPosition:[o.projectionMethod,o.dimension]}}),b=(e,t)=>new we["a"]({id:"label-outline-layer",data:e,pickable:!1,getPosition:e=>{if(!o.showAll||!t[e.index])return"2D"===o.dimension?[0,0]:[0,0,0];let n=s(e),a=o.zoom<=3.5?.1:o.zoom<=5.5?.1/o.zoom:o.zoom<=8?.08/o.zoom:.05/(1.5*o.zoom),i=1/Math.pow(1.5,o.zoom)+a;return[n[0]+i,n[1]+a]},getText:e=>e.value,getColor:e=>o.showAll&&t[e.index]?"light-theme"==o.userTheme?[255,255,255,$e]:[0,0,0,$e]:[255,255,255,0],getSize:12,getAngle:0,getTextAnchor:"start",getAlignmentBaseline:"center",updateTriggers:{getColor:[o.zoom,o.highlightedTokenIndices,o.userTheme,o.showAll],getPosition:[o.projectionMethod,o.zoom]}}),m=(e,t)=>new we["a"]({id:"point-label-layer",data:e,pickable:!1,getPosition:e=>{if(!o.showAll||!t[e.index])return"2D"===o.dimension?[0,0]:[0,0,0];let n=s(e),a=1/Math.pow(1.5,o.zoom);return 2==n.length?[n[0]+a,n[1]]:[n[0]+a,n[1],n[2]+a]},getText:e=>e.value,getColor:e=>o.showAll&&t[e.index]?0===o.highlightedTokenIndices.length||o.highlightedTokenIndices.includes(e.index)?"query"==e.type?"light-theme"==o.userTheme?[43,91,25,$e]:[194,232,180,$e]:"light-theme"==o.userTheme?[117,29,58,$e]:[240,179,199,$e]:"query"==e.type?"light-theme"==o.userTheme?[43,91,25,Ue]:[194,232,180,Ue]:"light-theme"==o.userTheme?[117,29,58,Ue]:[240,179,199,Ue]:[255,255,255,0],getSize:12,getAngle:0,getTextAnchor:"start",getAlignmentBaseline:"center",updateTriggers:{getColor:[o.zoom,o.highlightedTokenIndices,o.userTheme,o.showAll,o.dimension],getPosition:[o.projectionMethod,o.zoom]}}),p=e=>new we["a"]({id:"text-layer",data:e,pickable:!1,getPosition:e=>e.coordinate,getText:e=>e.title,getSize:"single"==o.mode?24:20,sizeMaxPixels:24,getAngle:0,getColor:"light-theme"==o.userTheme?[0,0,0]:[255,255,255],sizeUnits:"single"==o.mode?"pixels":"common",getTextAnchor:"start",getAlignmentBaseline:"center",updateTriggers:{getColor:o.userTheme}}),g=e=>new xe["a"]({id:"overlay-layer",data:e,pickable:!0,strokable:!1,filled:!0,extruded:"3D"==o.dimension,getPolygon:e=>[e.coordinate,[e.coordinate[0],e.coordinate[1]+Le],[e.coordinate[0]+Ce,e.coordinate[1]+Le],[e.coordinate[0]+Ce,e.coordinate[1]]],getFillColor:[255,255,255,0],getElevation:100,getLineWidth:0,onClick:(e,t)=>{let n=e.object;_(n.layer,n.head,!0)},updateTriggers:{getPosition:[o.projectionMethod,o.zoom]}}),j=e=>{let t=s(e),n=l(e.value,12),o={minX:t[0]-.5*n.width,minY:t[1]-.5*n.width,maxX:t[0]+.5*n.width,maxY:t[1]+.5*n.height};const a=c.collides(o);return!a&&(c.insert(o),!0)},f=()=>{let{points:e,headings:t}=a.value;if(""!==o.curHead&&""!==o.curLayer){const n=e.length/t.length;let a=t.findIndex(e=>e.layer==o.curLayer&&e.head==o.curHead),i=n*a,s=i+n;const r=e.slice(i,s);o.activePoints=r;const l=t[a];c.clear();const g=r.map(e=>j(e));let f=[];if("attn"===o.view){if(o.showAttention){""!=o.clickedPoint&&(o.clickedPoint=r[o.clickedPoint.index]);const e=r.filter(e=>o.highlightedTokenIndices.includes(e.index));f.push(d(e))}f.push(h([o.clickedPoint]))}return f.push(u(r)),f.push(p([l])),"2D"==o.dimension&&f.push(b(r,g)),f.push(m(r,g)),f}return[u(e),p(t),g(t)]},y=()=>{const{points:e,headings:t,range:s}=a.value;console.log("initMatrices",e,t),e&&e.length&&(De=s.x[0]+s.x[1],Se=s.y[0]+s.y[1],Fe={target:[De/2,Se/2,0],zoom:-1,minZoom:-1.5,maxZoom:9,transitionDuration:1e3},o.viewState="matrix"===o.mode?Fe:Ee,i=new fe["a"]({canvas:"matrix-canvas",controller:!0,views:"3D"==o.dimension?new ye["a"]({orbitAxis:"Y"}):new Oe["a"]({flipY:!1}),initialViewState:o.viewState,layers:f(),getTooltip:({object:e})=>{const t=e=>{switch(o.colorBy){case"type":case"position":case"punctuation":return e.msg.position;case"categorical":return e.msg.categorical;case"norm":return e.msg.norm;case"length":return e.msg.length;default:throw Error("invalid msg channel")}};return e&&{html:"matrix"===o.mode?e.title:t(e),style:{color:"#fff",background:"#222"}}},onViewStateChange:e=>{e.interactionState.inTransition&&(clearTimeout(He),He=setTimeout((function(){O(e)}),100))}}),n.commit("updateRenderState",!1))};onwheel=e=>{o.transitionInProgress&&e.preventDefault,"matrix"===o.mode&&(o.cursorX=e.offsetX,o.cursorY=e.offsetY)};const O=e=>{const t=e.viewState.zoom,n=o.zoom;o.zoom=t;let a=Ie;if("3D"===o.dimension&&(a=1.5),o.transitionInProgress=!0,n<a&&t>=a){const e=i.pickObject({x:o.cursorX,y:o.cursorY,radius:100,layerIds:["overlay-layer"],unproject3D:"3D"===o.dimension});if(e){let t=e.object;_(t.layer,t.head,!1)}}else n>=a&&t<a&&k(!1);o.transitionInProgress=!1},k=e=>{"matrix"!==o.mode&&(n.commit("setMode","matrix"),n.commit("setLayer",""),n.commit("setHead",""),o.activePoints=[]),"attn"==o.view&&n.commit("setHighlightedTokenIndices",[]),o.viewState=Fe,e&&i.setProps({initialViewState:o.viewState})},v=()=>{const e=o.viewState.target,t=i.getViewports()[0].center,n=i.getViewports()[0].zoom;e[0]==t[0]&&e[1]==t[1]&&o.zoom==n&&"2D"===o.dimension||("matrix"==o.mode?i.setProps({initialViewState:Ve}):i.setProps({initialViewState:Ne}),i.setProps({initialViewState:o.viewState}))},w=()=>{let{matrixData:e,tokenData:t}=o;if(e.length&&t.length){let n=ze(e,t);a.value=n}},x=e=>{e=e.toLowerCase();let t=o.tokenData.map((t,n)=>t.value===e?n:void 0).filter(e=>e);return n.commit("setHighlightedTokenIndices",t),t.length},T=()=>{console.error("viewport",i.getViewports())},_=(e,t,a)=>{"single"!==o.mode&&n.commit("setMode","single");const s=t*(Ce+Me)+.5*Ce,c=-e*(Le+Me)+.5*Le;Ee={target:[s,c,0],zoom:Ie,minZoom:-1.5,maxZoom:9,transitionDuration:1e3},o.viewState=Ee,a&&i.setProps({initialViewState:o.viewState}),console.log("Layer "+e+", Head "+t),n.commit("setLayer",e),n.commit("setHead",t)};return Object(r["x"])(()=>{console.log("onMounted"),w()}),Object(r["M"])([()=>o.matrixData,()=>o.tokenData],()=>{o.doneLoading&&w()}),Object(r["M"])([a],()=>{y()}),Object(r["M"])(()=>o.dimension,()=>{if(i.setProps({views:"3D"==o.dimension?new ye["a"]({orbitAxis:"Y"}):new Oe["a"]({flipY:!1})}),"single"==o.mode){"3D"===o.dimension&&v();const e=i.getViewports()[0].zoom;o.zoom=e<Ie?Ie:e}i.setProps({layers:[...f()]})}),Object(r["M"])([()=>o.highlightedTokenIndices,()=>o.projectionMethod,()=>o.colorBy,()=>o.userTheme,()=>o.curHead,()=>o.curLayer,()=>o.zoom,()=>o.showAll,()=>o.showAttention,()=>o.sizeByNorm,()=>o.attentionLoading,()=>o.clickedPoint],()=>{"attn"===o.view&&o.attentionLoading||i.setProps({layers:[...f()]})}),Object(r["M"])([()=>o.doneLoading,()=>o.curLayer,()=>o.curHead],()=>{if(o.doneLoading&&0!=o.activePoints.length&&"attn"===o.view&&""!=o.clickedPoint){let e=o.highlightedTokenIndices[o.highlightedTokenIndices.length-1],t=o.activePoints[e];o.clickedPoint=t,n.dispatch("setClickedPoint",t)}}),Object(r["M"])(()=>o.highlightedTokenIndices,()=>{0==o.highlightedTokenIndices.length&&(n.commit("setView","none"),o.clickedPoint="")}),t.expose({reset:k,resetZoom:v,onSearch:x,printViewport:T,zoomToPlot:_}),{...Object(r["K"])(o)}}});n("5afb");const Re=U()(qe,[["render",je],["__scopeId","data-v-22f1b35c"]]);var Ze=Re;const Je={id:"legend"},Ye=Object(r["k"])("span",null,"q",-1),Ge={class:"low"},Ke={class:"high"},Xe=Object(r["k"])("span",null,"k",-1),We={class:"low"},Qe={class:"high"};function et(e,t,n,o,a,i){return Object(r["P"])((Object(r["A"])(),Object(r["j"])("div",Je,[Object(r["k"])("div",{class:Object(r["u"])(["bar-contain",{pos:"position"==e.colorBy||"norm"==e.colorBy||"length"==e.colorBy,cat:"categorical"==e.colorBy,pun:"punctuation"==e.colorBy}])},[Ye,Object(r["k"])("div",{class:Object(r["u"])(["bar",{smaller:"norm"==e.colorBy||"punctuation"==e.colorBy}])},[Object(r["k"])("span",Ge,Object(r["J"])(e.lowLabel(e.colorBy)),1),Object(r["k"])("span",Ke,Object(r["J"])(e.highLabel(e.colorBy)),1)],2)],2),Object(r["k"])("div",{class:Object(r["u"])(["bar-contain k",{pos:"position"==e.colorBy||"norm"==e.colorBy||"length"==e.colorBy,cat:"categorical"==e.colorBy,pun:"punctuation"==e.colorBy}])},[Xe,Object(r["k"])("div",{class:Object(r["u"])(["bar",{smaller:"norm"==e.colorBy||"punctuation"==e.colorBy}])},[Object(r["k"])("span",We,Object(r["J"])(e.lowLabel(e.colorBy)),1),Object(r["k"])("span",Qe,Object(r["J"])(e.highLabel(e.colorBy)),1)],2)],2)],512)),[[r["L"],!e.renderState]])}var tt=Object(r["n"])({setup(){const e=V(),t=Object(r["E"])({colorBy:Object(r["h"])(()=>e.state.colorBy),renderState:Object(r["h"])(()=>e.state.renderState)});return{...Object(r["K"])(t)}},methods:{lowLabel(e){switch(e){case"position":case"categorical":case"length":return"0";case"norm":return"low";case"punctuation":return".?!";default:}},highLabel(e){switch(e){case"position":case"length":return"1";case"categorical":return"4";case"norm":return"high";case"punctuation":return"abc";default:}}}});n("f78d");const nt=U()(tt,[["render",et]]);var ot=nt,at=n("e180"),it=n("9af8"),st=n("1cd4"),ct=n("083e"),rt=Object(r["n"])({components:{MatrixView:Ze,Legend:ot,ArrowUpOutlined:at["a"],ArrowDownOutlined:it["a"],ArrowLeftOutlined:st["a"],ArrowRightOutlined:ct["a"]},setup(){const e=V(),t=Object(r["F"])(null),n=Object(r["E"])({mode:Object(r["h"])(()=>e.state.mode),renderState:Object(r["h"])(()=>e.state.renderState),searchToken:"",view:Object(r["h"])(()=>e.state.view),showAll:Object(r["h"])(()=>e.state.showAll),sizeByNorm:Object(r["h"])(()=>e.state.sizeByNorm),showAttention:Object(r["h"])(()=>e.state.showAttention),colorBy:Object(r["h"])(()=>e.state.colorBy),layer:Object(r["h"])(()=>e.state.layer),head:Object(r["h"])(()=>e.state.head),modelType:Object(r["h"])(()=>e.state.modelType),dimension:Object(r["h"])({get:()=>e.state.dimension,set:t=>e.commit("setDimension",t)})}),o=()=>{t.value.resetZoom()},a=()=>{t.value.reset(!0)},i=()=>{n.searchToken="",s(n.searchToken)},s=o=>{e.commit("setView","search");let a=t.value.onSearch(o);""!=o&&(n.searchToken=o+" ("+a+" results)")},c=()=>{setTimeout(()=>{t.value.printViewport()},100)},l=()=>{e.commit("setShowAll",!n.showAll)},d=()=>{e.commit("setShowAttention",!n.showAttention)},h=()=>{e.commit("setSizeByNorm",!n.sizeByNorm)},u=(e,n)=>{t.value.zoomToPlot(e,n,!0)},b=e=>{switch(e){case"up":u(n.layer-1,n.head);break;case"left":u(n.layer,n.head-1);break;case"right":u(n.layer,n.head+1);break;case"down":u(n.layer+1,n.head);break;default:throw Error("Invalid direction!")}};return Object(r["M"])(()=>n.view,()=>{"attn"==n.view&&(n.searchToken="")}),Object(r["M"])(()=>n.modelType,()=>{e.commit("setHighlightedTokenIndices",[]),n.searchToken.length>0&&(n.searchToken="")}),{...Object(r["K"])(n),matrixView:t,onClickReset:o,resetToMatrix:a,clearSearch:i,onSearch:s,logViewport:c,zoomToPlot:u,moveToPlot:b,toggleCheckbox:l,toggleCheckboxNorm:h,toggleCheckboxAttention:d}}});n("a39d");const lt=U()(rt,[["render",pe]]);var dt=lt;const ht={class:"viewHead",id:"attn-map-view"},ut={class:"align-top"},bt=Object(r["l"])("Sentence View "),mt={class:"attn-btns"},pt=Object(r["l"])("reset"),gt=Object(r["k"])("span",null,"|",-1),jt=Object(r["l"])("clear"),ft={class:"subtitle"},yt=Object(r["k"])("p",{class:"label"},"Hide",-1),Ot=Object(r["l"])("first token"),kt=Object(r["l"])("[cls]"),vt=Object(r["l"])("[sep]"),wt={id:"bertviz"},xt=Object(r["k"])("div",{id:"vis"},null,-1),Tt=[xt];function _t(e,t,n,o,a,i){const s=Object(r["H"])("a-button"),c=Object(r["H"])("a-checkbox");return Object(r["A"])(),Object(r["j"])("div",ht,[Object(r["k"])("div",ut,[Object(r["k"])("p",null,[bt,Object(r["m"])(r["e"],null,{default:Object(r["O"])(()=>[Object(r["P"])(Object(r["k"])("span",null,"("+Object(r["J"])(e.layerHead)+")",513),[[r["L"],e.showAttn]])]),_:1})]),Object(r["m"])(r["e"],null,{default:Object(r["O"])(()=>[Object(r["P"])(Object(r["k"])("div",mt,[Object(r["m"])(s,{id:"attn-reset",class:"clear",type:"link",onClick:o.resetAttn},{default:Object(r["O"])(()=>[pt]),_:1},8,["onClick"]),gt,Object(r["m"])(s,{id:"attn-clear",class:"clear",type:"link",onClick:o.clearAttn},{default:Object(r["O"])(()=>[jt]),_:1},8,["onClick"])],512),[[r["L"],e.showAttn]])]),_:1})]),Object(r["k"])("span",ft,Object(r["J"])(e.attnMsg),1),Object(r["m"])(r["e"],null,{default:Object(r["O"])(()=>[Object(r["P"])(Object(r["k"])("div",null,[yt,Object(r["P"])(Object(r["m"])(c,{checked:e.hideFirst,"onUpdate:checked":t[0]||(t[0]=t=>e.hideFirst=t),onClick:t[1]||(t[1]=e=>o.hideTokens("first"))},{default:Object(r["O"])(()=>[Ot]),_:1},8,["checked"]),[[r["L"],"gpt"==e.model]]),Object(r["P"])(Object(r["m"])(c,{checked:e.hideFirst,"onUpdate:checked":t[2]||(t[2]=t=>e.hideFirst=t),onClick:t[3]||(t[3]=e=>o.hideTokens("first"))},{default:Object(r["O"])(()=>[kt]),_:1},8,["checked"]),[[r["L"],"bert"==e.model]]),Object(r["P"])(Object(r["m"])(c,{checked:e.hideLast,"onUpdate:checked":t[4]||(t[4]=t=>e.hideLast=t),onClick:t[5]||(t[5]=e=>o.hideTokens("last"))},{default:Object(r["O"])(()=>[vt]),_:1},8,["checked"]),[[r["L"],"bert"==e.model]])],512),[[r["L"],e.showAttn]])]),_:1}),Object(r["m"])(r["e"],null,{default:Object(r["O"])(()=>[Object(r["P"])(Object(r["k"])("div",wt,Tt,512),[[r["L"],e.showAttn]])]),_:1})])}const At=12,zt=80,Pt=18,Bt=100,Lt=22;var Ct={components:{},setup(){const e=V(),t=Object(r["E"])({attentionByToken:Object(r["h"])(()=>e.state.attentionByToken),showAttn:!1,attnMsg:"click a plot to zoom in",highlightedTokenIndices:Object(r["h"])(()=>e.state.highlightedTokenIndices),view:Object(r["h"])(()=>e.state.view),curLayer:Object(r["h"])(()=>e.state.layer),curHead:Object(r["h"])(()=>e.state.head),layerHead:"",userTheme:Object(r["h"])(()=>e.state.userTheme),mode:Object(r["h"])(()=>e.state.mode),model:Object(r["h"])(()=>e.state.modelType),attn_vals:[],cur_attn:[],hidden:{left:[],right:[]},hideFirst:!1,hideLast:!1}),n=e=>t.cur_attn.map(t=>{let n=1-t[e];return t.map((t,o)=>o!=e?0==n?0:Math.min(1,t/n):0)}),o=()=>{let{attentionByToken:e}=t;t.attn_vals=e.attns;const o=e.token.type,a=e.token.pos_int,i=e.token.sentence.split(" ");"key"==o&&(t.attn_vals=p(t.attn_vals)),t.cur_attn=t.attn_vals,t.hidden["left"]=[],t.hidden["right"]=[],t.hideFirst&&(t.cur_attn=n(0),t.hidden["right"].push(0)),t.hideLast&&(t.cur_attn=n(i.length-1),t.hidden["right"].push(i.length-1)),t.layerHead="L"+t.curLayer+" H"+t.curHead;const s={attention:[{name:null,attn:[[t.cur_attn]],left_text:i,right_text:i,layer:0,head:0}],default_filter:"0",root_div_id:"bertviz",layer:0,heads:[0],include_layers:[0]};let c=r();function r(){let e={attention:s["attention"],filter:s["default_filter"],rootDivId:s["root_div_id"],layers:s["include_layers"],nHeads:0,nLayers:0,headVis:[],initialTextLength:0,layer:0,layer_seq:0};return e.nLayers=e.attention[e.filter]["attn"].length,e.nHeads=e.attention[e.filter]["attn"][0].length,s["heads"]?(e.headVis=new Array(e.nHeads).fill(!1),s["heads"].forEach(t=>e.headVis[t]=!0)):e.headVis=new Array(e.nHeads).fill(!0),e.initialTextLength=e.attention[e.filter].right_text.length,e.layer_seq=null==s["layer"]?0:e.layers.findIndex(e=>s["layer"]===e),e.layer=e.layers[e.layer_seq],e}function l(){const e=c.attention[c.filter],t=e.left_text,n=e.right_text;document.getElementById("vis").innerHTML="";const i=e.attn[c.layer_seq],s=Math.max(t.length,n.length)*Pt+Lt,r=Te["g"](`#${c.rootDivId} #vis`).append("svg").attr("id","main-svg").attr("width","100%").attr("height",s+"px"),l=r.append("defs"),u=l.append("linearGradient").attr("id","svgGradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","100%").attr("gradientUnits","userSpaceOnUse");u.append("stop").attr("class","start").attr("offset","0%").attr("stop-color","#9dd887").attr("stop-opacity",1),u.append("stop").attr("class","end").attr("offset","100%").attr("stop-color","#ea8aaa").attr("stop-opacity",1),d(r,t,!0,i,0),d(r,n,!1,i,Bt+zt);const b="query"==o?"left":"right";let m=document.querySelectorAll("#"+b+" text")[a+1];m.classList.add("bold"),m.classList.add(o),h(r,i)}function d(e,o,a,i,s){const r=e.append("svg:g").attr("id",a?"left":"right"),d=r.append("text").attr("x",s).attr("y",0).text(a?"query":"key").attr("font-size",At+2+"px").classed("bold",!0).classed(a?"query":"key",!0);a?d.style("text-anchor","end").attr("dx",zt-.5*At).attr("dy",At):d.style("text-anchor","start").attr("dx",.5*At).attr("dy",At),r.append("g").classed("attentionBoxes",!0).selectAll("g").data(i).enter().append("g").attr("head-index",(e,t)=>t).selectAll("rect").data(e=>a?e:p(e)).enter().append("rect").attr("x",(function(){var e=+this.parentNode.getAttribute("head-index");return s+b(e)})).attr("y",1*Pt).attr("width",zt/m()).attr("height",Pt).attr("fill",(function(){return a?"rgb(157, 216, 135)":"rgb(234, 138, 170)"})).style("opacity",0);const h=r.append("g").selectAll("g").data(o).enter().append("g");h.append("rect").classed("background",!0).style("opacity",0).attr("x",s).attr("y",(e,t)=>Lt+t*Pt).attr("width",zt).attr("height",Pt);const u=h.append("text").text(e=>e).attr("font-size",At+"px").style("cursor","default").style("-webkit-user-select","none").classed("token-text",!0).attr("x",s).attr("y",(e,t)=>Lt+t*Pt);a?u.style("text-anchor","end").attr("dx",zt-.5*At).attr("dy",At):u.style("text-anchor","start").attr("dx",.5*At).attr("dy",At),h.on("click",(function(e,o){const i=h.nodes(),s=i.indexOf(this);let r,d;if(0==s?t.hideFirst=!t.hideFirst:s==i.length-1&&(t.hideLast=!t.hideLast),a){let e=t.hidden["left"].indexOf(s);-1!=e?(r=!0,delete t.hidden["left"][e]):(r=!1,t.hidden["left"].push(s));let n=t.cur_attn[s].length;r?(d=t.cur_attn[s].map((e,n)=>t.attn_vals[s][n]),t.cur_attn[s]=d):t.cur_attn[s]=new Array(n).fill(0)}else{let e=t.hidden["right"].indexOf(s);-1!=e?(r=!0,delete t.hidden["right"][e]):(r=!1,t.hidden["right"].push(s)),d=r?t.cur_attn.map((e,n)=>{let o=1,a=n;return t.hidden["right"].forEach((e,n)=>{o-=t.attn_vals[a][e]}),e.map((e,n)=>0==o||t.hidden["right"].includes(n)?0:Math.min(1,t.attn_vals[a][n]/o))}):n(s),t.cur_attn=d}c.attention[c.filter].attn=[[t.cur_attn]],l()})),h.on("mouseover",(function(t,n){const o=h.nodes(),i=o.indexOf(this);r.selectAll(".background").style("opacity",(function(e,t){return t===i?1:0})),e.select("#attention").selectAll("line[visibility='visible']").attr("visibility",null),e.select("#attention").attr("visibility","hidden"),a?e.select("#attention").selectAll("line[left-token-index='"+i+"']").attr("visibility","visible"):e.select("#attention").selectAll("line[right-token-index='"+i+"']").attr("visibility","visible");const s=a?"right":"left",l=a?Bt+zt:0;e.select("#"+s).selectAll(".attentionBoxes").selectAll("g").attr("head-index",(e,t)=>t).selectAll("rect").attr("x",(function(){const e=+this.parentNode.getAttribute("head-index");return l+b(e)})).attr("y",(e,t)=>Lt+t*Pt).attr("width",zt/m()).attr("height",Pt).style("opacity",(function(e){const t=+this.parentNode.getAttribute("head-index");return c.headVis[t]&&e?e[i]:0}))})),r.on("mouseleave",(function(){Te["g"](this).selectAll(".background").style("opacity",0),e.select("#attention").selectAll("line[visibility='visible']").attr("visibility",null),e.select("#attention").attr("visibility","visible"),e.selectAll(".attentionBoxes").selectAll("g").selectAll("rect").style("opacity",0)}))}function h(e,t){e.select("#attention").remove(),e.append("g").attr("id","attention").selectAll(".headAttention").data(t).enter().append("g").classed("headAttention",!0).attr("head-index",(e,t)=>t).selectAll(".tokenAttention").data(e=>e).enter().append("g").classed("tokenAttention",!0).attr("left-token-index",(e,t)=>t).selectAll("line").data(e=>e).enter().append("line").attr("x1",zt).attr("y1",(function(){const e=+this.parentNode.getAttribute("left-token-index");return Lt+e*Pt+Pt/2})).attr("x2",zt+Bt).attr("y2",(e,t)=>Lt+t*Pt+Pt/2).attr("stroke-width",2).attr("stroke",(function(){return"url(#svgGradient)"})).attr("left-token-index",(function(){return+this.parentNode.getAttribute("left-token-index")})).attr("right-token-index",(e,t)=>t),u(e)}function u(e){e.select("#attention").selectAll("line").attr("stroke-opacity",(function(e){const t=+this.parentNode.parentNode.getAttribute("head-index");return c.headVis[t]?e/m():0}))}function b(e){const t=c.headVis.reduce((function(t,n,o){return n&&o<e?t+1:t}),0);return t*(zt/m())}function m(){return c.headVis.reduce((function(e,t){return t?e+1:e}),0)}function p(e){return e[0].map((function(t,n){return e.map((function(e){return e[n]}))}))}l()},a=()=>{t.showAttn=!1,t.attnMsg="single"==t.mode?"click a point to explore its attention":"click a plot to zoom in",e.commit("setHighlightedTokenIndices",[])},i=()=>{t.hideFirst=!1,t.hideLast=!1,t.hidden["left"]=[],t.hidden["right"]=[],o()},s=e=>{const t=Te["g"]("#main-svg #right .attentionBoxes + g");let n;n="first"==e?t.selectChild(":first-child"):t.selectChild(":last-child"),n.dispatch("click")};return Object(r["M"])(()=>[t.attentionByToken],()=>{t.showAttn=!0,t.attnMsg="click a token to toggle lines off/on",o()}),Object(r["M"])(()=>[t.view,t.mode],()=>{"attn"!=t.view&&(t.showAttn=!1,t.attnMsg="single"==t.mode?"click a point to explore its attention":"click a plot to zoom in")}),{...Object(r["K"])(t),clearAttn:a,bertviz:o,hideTokens:s,resetAttn:i}}};n("228a");const Mt=U()(Ct,[["render",_t]]);var Dt=Mt,St=Object(r["n"])({name:"App",components:{UserPanel:R,Projection:dt,AttnMap:Dt},setup(){const e=V(),t=Object(r["F"])(null),n=Object(r["E"])({storeLayer:Object(r["h"])(()=>e.state.layer),storeHead:Object(r["h"])(()=>e.state.head),layernum:"",headnum:"",mode:Object(r["h"])(()=>e.state.mode),modelType:Object(r["h"])({get:()=>e.state.modelType,set:t=>e.dispatch("switchModel",t)}),modelOptions:["bert","gpt"].map(e=>({value:e,label:e})),projectionMethod:Object(r["h"])({get:()=>e.state.projectionMethod,set:t=>e.commit("setProjectionMethod",t)}),projectionMethods:["tsne","umap","pca"].map(e=>({value:e,label:e})),colorBy:Object(r["h"])({get:()=>e.state.colorBy,set:t=>e.commit("setColorBy",t)}),colorByOptions:["type","position","categorical","punctuation","norm","length"].map(e=>({value:e,label:e})),userTheme:Object(r["h"])(()=>e.state.userTheme)});Object(r["x"])(async()=>{await e.dispatch("init");const t=l()||h();d(t)});const o=function(e,t){"layer"==e?n.layernum=t:n.headnum=t},a=()=>{let e=n.layernum,o=n.headnum;t.value.zoomToPlot(e,o)},i=()=>{t.value.onClickReset()},s=()=>{t.value.resetToMatrix()},c=()=>{const e=localStorage.getItem("user-theme");d("light-theme"===e?"dark-theme":"light-theme")},l=()=>localStorage.getItem("user-theme"),d=t=>{localStorage.setItem("user-theme",t),document.documentElement.className=t,e.commit("setUserTheme",t)},h=()=>{const e=window.matchMedia("(prefers-color-scheme: dark)").matches;return e?"dark-theme":"light-theme"};return Object(r["M"])([()=>n.storeHead,()=>n.storeLayer],()=>{n.layernum=n.storeLayer,n.headnum=n.storeHead}),{...Object(r["K"])(n),projection:t,handleChange:o,zoomToPlot:a,onClickReset:i,resetToMatrix:s,toggleTheme:c,getTheme:l,setTheme:d,getMediaPreference:h}},computed:{icon(){return"dark-theme"===this.userTheme?["fas","sun"]:["fas","moon"]}}});n("9457");const Ht=U()(St,[["render",_]]);var It=Ht,Vt=n("be33"),Nt=n("ad3d"),Ft=n("11ca");Vt["c"].add(Ft["a"],Ft["b"]),Object(r["i"])(It).use(I,H).use(o["a"]).use(a["a"]).use(i["a"]).use(s["a"]).use(c["a"]).component("font-awesome-icon",Nt["a"]).mount("#app")},cffb:function(e,t,n){},f78d:function(e,t,n){"use strict";n("cffb")}});
//# sourceMappingURL=app.5483bd3e.js.map